# 《两周自制脚本语言》总结

## 一、词法分析（Lexical Analysis）

词法分析的目的在于将输入的源代码（一大串字符文本）拆解成一个一个基本组成单元（Token），并且在拆解的过程中，提炼出 Token 的类型（比如：字符串，标识符，数值等）等信息，为后面语法分析打下基础。

在该书中， 通过正则表达式的方式来完成此任务。

为了简单起见，这里我们设定语法规则如下：

| 类型   | 具体语法规定                             |
| ---- | ---------------------------------- |
| 注释   | 以`//`开头的内容                         |
| 数值   | 暂定只支持整数，为了简单起见09这样的整数也认为是合法的       |
| 字符串  | `""`内的内容，支持`\\`、`\"`、`\n`转义字符      |
| 标识符  | 以字母或下划线开头，后接字母数字下划线的变量名；各种操作符、标点符号 |

具体正则表达式为：`"\\s*((//.*)|([0-9]+)|(\"(\\\\\"|\\\\\\\\|\\\\n|[^\"])*\")|[A-Z_a-z][A-Z_a-z0-9]*|==|<=|>=|&&|\\|\\||\\p{Punct})?";`

上述正则表达式与上表中的内容是一一对应的，匹配时首先跳过这一行的空格（`"\\s*"`），后面的内容都为有效的内容，因此用一个大的括号括起来，便于得到其内容。

在这个大的括号之中：

第一对括号中的内容`//.*`用于匹配注释

第二对括号中的内容`"[0-9]+"`用来匹配数值类型的 Token；

第三对括号内的内容`\"(\\\\\"|\\\\\\\\|\\\\n|[^\"])*\"`用来对匹配字符串类型的 Token，由于字符串本身`\`需要转义，正则表达式中的`\`同样需要转义，因此这里的`\`非常的多，不过还是很容易分析的：`\\\\\"`这一部分用来匹配字符串中的`\"`，`\\\\\\\\`用来匹配字符串中的`\\`，`\\\\n`用来匹配字符串中的`\n`，剩下`[^\"]`用来匹配一切非`"`字符，至此整个字符串的匹配模式就完成了；

剩下的内容`[A-Z_a-z][A-Z_a-z0-9]*|==|<=|>=|&&|\\|\\||\\p{Punct})?`用于匹配标识符，为了简单起见，我们对标识符的定义非常广泛，日后可以更加细化。

整个正则表达式分析完后，对源代码进行词法分析就是对源代码进行正则表达式的模式匹配，通过一行一行地遍历整个源代码，对其中每一行进行单独解析，设置正则式的范围，将该行中所有满足要求的字符串构建成不同类型的 Token，并保存到一个序列中，以便后续语法分析。